<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>RAT –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç - –ö–æ–Ω—Ç—Ä–æ–ª—å 2</title>
    <script src="https://unpkg.com/jspsych@7.3.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.2"></script>
    <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" />
    <style>
        body { 
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        .rat-container { 
            font-size: 22px; 
            max-width: 900px; 
            margin: 50px auto;
            text-align: center;
            line-height: 1.8;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .rat-words { 
            font-weight: bold; 
            color: #2c3e50; 
            margin: 30px 0; 
            font-size: 36px;
            letter-spacing: 2px;
        }
    </style>
</head>
<body></body>
<script>

const CONDITION = 'control2';
const PARTICIPANT_ID = 'P' + Date.now();

const jsPsych = initJsPsych({
    on_finish: function() {
        const main_data = jsPsych.data.get().filter({trial_type_marker: 'rat_task', is_practice: false});
        const correct = main_data.filter({correct: true}).count();
        const total = main_data.count();
        
        jsPsych.getDisplayElement().innerHTML = `
            <div class="rat-container">
                <h2>–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!</h2>
                <p>–í—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ—à–∏–ª–∏ ${correct} –∏–∑ ${total} –∑–∞–¥–∞—á.</p>
                <br>
                <h3>–ë–æ–ª—å—à–æ–µ —Å–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ!</h3>
                <br><br>
                <button onclick="downloadData()" style="font-size: 18px; padding: 15px 30px; cursor: pointer; background: #3498db; color: white; border: none; border-radius: 5px;">
                    üì• –°–∫–∞—á–∞—Ç—å –º–æ–∏ –¥–∞–Ω–Ω—ã–µ
                </button>
            </div>
        `;
    }
});

function downloadData() {
    jsPsych.data.get().localSave('csv', `data_${CONDITION}_${PARTICIPANT_ID}.csv`);
}

// –í–∞—à–∏ 20 RAT –∑–∞–¥–∞—á
const RAT_TASKS = [
    {words: ['–ü–ê–î–ê–¢–¨', '–õ–ê–ó–ò–¢–¨', '–ü–†–û–í–û–î–ò–¢–¨'], answer: '–í–û–î–ê'},
    {words: ['–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨', '–í–û–ó–ò–¢–¨', '–£–í–õ–ê–ñ–ù–Ø–¢–¨'], answer: '–ü–ê–†'},
    {words: ['–•–†–ê–ù–ò–¢–¨', '–õ–Æ–ë–ò–¢–¨', '–ò–ó–î–ê–í–ê–¢–¨'], answer: '–ö–ù–ò–ì–ê'},
    {words: ['–†–£–ë–ò–¢–¨', '–í–û–ó–ò–¢–¨', '–ü–ò–õ–ò–¢–¨'], answer: '–õ–ï–°'},
    {words: ['–ú–ï–¢–ê–¢–¨', '–¢–£–®–ò–¢–¨', '–°–¢–û–Ø–¢–¨'], answer: '–û–ì–û–ù–¨'},
    {words: ['–õ–ï–¢–ê–¢–¨', '–ü–ê–î–ê–¢–¨', '–°–ß–ò–¢–ê–¢–¨'], answer: '–ó–í–ï–ó–î–ê'},
    {words: ['–ü–ï–ß–¨', '–°–¢–û–Ø–¢–¨', '–õ–ï–ß–ò–¢–¨'], answer: '–°–û–õ–ù–¶–ï'},
    {words: ['–°–ö–õ–ê–î–´–í–ê–¢–¨', '–°–û–ß–ï–¢–ê–¢–¨', '–£–ü–û–¢–†–ï–ë–õ–Ø–¢–¨'], answer: '–°–õ–û–í–û'},
    {words: ['–ó–ê–ü–ò–°–´–í–ê–¢–¨', '–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨', '–ù–ê–ë–õ–Æ–î–ê–¢–¨'], answer: '–í–ò–î–ï–û'},
    {words: ['–†–ï–ó–ê–¢–¨', '–õ–û–ú–ê–¢–¨', '–ö–†–£–ñ–ò–¢–¨'], answer: '–ì–û–õ–û–í–ê'},
    {words: ['–†–ï–ñ–ò–°–°–ò–†–û–í–ê–¢–¨', '–ò–ó–û–õ–ò–†–û–í–ê–¢–¨', '–£–°–ò–õ–ò–í–ê–¢–¨'], answer: '–ó–í–£–ö'},
    {words: ['–ü–ò–°–ê–¢–¨', '–ü–û–ñ–ò–ú–ê–¢–¨', '–ú–´–¢–¨'], answer: '–†–£–ö–ê'},
    {words: ['–°–ò–î–ï–¢–¨', '–°–¢–†–û–ò–¢–¨', '–£–ü–†–ê–í–õ–Ø–¢–¨'], answer: '–î–û–ú'},
    {words: ['–¢–†–Ø–°–¢–ò', '–†–´–¢–¨', '–î–ï–õ–ê–¢–¨'], answer: '–ó–ï–ú–õ–Ø'},
    {words: ['–•–†–ê–ù–ò–¢–¨', '–ì–†–ï–¢–¨', '–î–í–ò–ì–ê–¢–¨'], answer: '–¢–ï–õ–û'},
    {words: ['–ü–ò–¢–¨', '–í–ê–†–ò–¢–¨', '–ú–û–õ–û–¢–¨'], answer: '–ö–û–§–ï'},
    {words: ['–ü–ê–î–ê–¢–¨', '–¢–ï–°–ê–¢–¨', '–î–†–û–ë–ò–¢–¨'], answer: '–ö–ê–ú–ï–ù–¨'},
    {words: ['–•–£–õ–ò–¢–¨', '–Ø–í–õ–Ø–¢–¨–°–Ø', '–°–õ–£–ñ–ò–¢–¨'], answer: '–ë–û–ì'},
    {words: ['–ö–û–õ–û–¢–¨', '–†–ï–ó–ê–¢–¨', '–•–û–î–ò–¢–¨'], answer: '–õ–Å–î'},
    {words: ['–¢–ï–ß–¨', '–•–ê–†–ö–ê–¢–¨', '–ò–ó–õ–ò–í–ê–¢–¨'], answer: '–ö–†–û–í–¨'}
];

let timeline = [];
let task_start = null;

// –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
        <div class="rat-container">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç!</h2>
            <p>–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –∑–∞–π–º—ë—Ç <strong>–Ω–µ –±–æ–ª–µ–µ 30 –º–∏–Ω—É—Ç</strong>.</p>
            <br>
            <p><strong>–í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:</strong></p>
            <ul style="text-align: left; max-width: 600px; margin: 20px auto; font-size: 20px;">
                <li>–ü–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –Ω–µ –æ—Ç–≤–ª–µ–∫–∞—Ç—å—Å—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á</li>
                <li>–ï—Å–ª–∏ –ø–æ—á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è –ø–ª–æ—Ö–æ ‚Äî –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç</li>
            </ul>
            <br>
            <p style="color: #e74c3c; font-weight: bold; font-size: 22px;">
                ‚ö° –ö–æ–≥–¥–∞ –ø–æ—á—É–≤—Å—Ç–≤—É–µ—Ç–µ –º–æ–º–µ–Ω—Ç –æ–∑–∞—Ä–µ–Ω–∏—è ("–≠–≤—Ä–∏–∫–∞!") ‚Äî —Å—Ä–∞–∑—É –Ω–∞–∂–º–∏—Ç–µ –ü–†–û–ë–ï–õ
            </p>
            <p>–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç</p>
            <br><br>
            <p><em>–ù–∞–∂–º–∏—Ç–µ –ü–†–û–ë–ï–õ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</em></p>
        </div>
    `,
    choices: [' ']
});

// –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
        <div class="rat-container">
            <h3>–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å?</h3>
            <p>–í—ã —É–≤–∏–¥–∏—Ç–µ <strong>3 –≥–ª–∞–≥–æ–ª–∞</strong>.</p>
            <p>–í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–π—Ç–∏ <strong>—Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ</strong>, –∫–æ—Ç–æ—Ä–æ–µ —Å–≤—è–∑–∞–Ω–æ —Å–æ –≤—Å–µ–º–∏ —Ç—Ä–µ–º—è –≥–ª–∞–≥–æ–ª–∞–º–∏.</p>
            <br>
            <p style="font-size: 20px;"><strong>–ü—Ä–∏–º–µ—Ä:</strong></p>
            <p style="font-size: 28px; color: #2c3e50;">–ü–ò–¢–¨ ¬∑ –í–ê–†–ò–¢–¨ ¬∑ –ú–û–õ–û–¢–¨</p>
            <p style="font-size: 22px;">–û—Ç–≤–µ—Ç: <strong>–ö–û–§–ï</strong></p>
            <br>
            <p style="font-size: 18px; color: #7f8c8d;">(–º–æ–∂–Ω–æ –ø–∏—Ç—å –∫–æ—Ñ–µ, –≤–∞—Ä–∏—Ç—å –∫–æ—Ñ–µ, –º–æ–ª–æ—Ç—å –∫–æ—Ñ–µ)</p>
            <br><br>
            <p><em>–ù–∞–∂–º–∏—Ç–µ –ü–†–û–ë–ï–õ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</em></p>
        </div>
    `,
    choices: [' ']
});

// –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è RAT –∑–∞–¥–∞—á–∏
function createRATTrial(task, task_number, is_practice = false) {
    let task_timeline = [];
    
    // –ü–æ–∫–∞–∑ —Å–ª–æ–≤
    task_timeline.push({
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
            <div class="rat-container">
                <p style="color: #95a5a6; font-size: 18px;">${is_practice ? 'üîπ –ü–†–û–ë–ù–ê–Ø –ó–ê–î–ê–ß–ê' : '–ó–∞–¥–∞—á–∞ ' + task_number + ' / 20'}</p>
                <p>–ù–∞–π–¥–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ, —Å–≤—è–∑–∞–Ω–Ω–æ–µ —Å –≥–ª–∞–≥–æ–ª–∞–º–∏:</p>
                <div class="rat-words">${task.words.join('   ¬∑   ')}</div>
                <br>
                <p style="color: #7f8c8d; font-size: 18px;">
                    <em>‚ö° –ù–∞–∂–º–∏—Ç–µ –ü–†–û–ë–ï–õ –≤ –º–æ–º–µ–Ω—Ç –∏–Ω—Å–∞–π—Ç–∞</em>
                </p>
            </div>
        `,
        choices: [' '],
        on_start: function() {
            task_start = performance.now();
        },
        on_finish: function(data) {
            const insight_time = performance.now() - task_start;
            data.insight_time = insight_time;
            data.task_words = task.words.join(',');
            data.correct_answer = task.answer;
            data.is_practice = is_practice;
            data.condition = CONDITION;
            data.participant_id = PARTICIPANT_ID;
            data.task_number = task_number;
        }
    });
    
    // –í–≤–æ–¥ –æ—Ç–≤–µ—Ç–∞
    task_timeline.push({
        type: jsPsychSurveyText,
        questions: [{
            prompt: `
                <div class="rat-container">
                    <p>–ì–ª–∞–≥–æ–ª—ã: <strong style="color: #2c3e50; font-size: 24px;">${task.words.join(' ¬∑ ')}</strong></p>
                    <p>–í–≤–µ–¥–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ:</p>
                </div>
            `,
            name: 'answer',
            required: true,
            placeholder: '–í–∞—à –æ—Ç–≤–µ—Ç'
        }],
        on_finish: function(data) {
            const user_answer = data.response.answer.toUpperCase().trim();
            data.correct = (user_answer === task.answer);
            data.user_answer = user_answer;
            data.task_words = task.words.join(',');
            data.correct_answer = task.answer;
            data.is_practice = is_practice;
            data.condition = CONDITION;
            data.participant_id = PARTICIPANT_ID;
            data.task_number = task_number;
            data.trial_type_marker = 'rat_task';
        }
    });
    
    return task_timeline;
}

// –ü—Ä–æ–±–Ω–∞—è –∑–∞–¥–∞—á–∞
timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
        <div class="rat-container">
            <h3>–ü—Ä–æ–±–Ω–∞—è –∑–∞–¥–∞—á–∞</h3>
            <p>–°–Ω–∞—á–∞–ª–∞ –ø–æ—Ç—Ä–µ–Ω–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ</p>
            <br>
            <p><em>–ù–∞–∂–º–∏—Ç–µ –ü–†–û–ë–ï–õ</em></p>
        </div>
    `,
    choices: [' ']
});

// –ü—Ä–æ–±–Ω–∞—è –∑–∞–¥–∞—á–∞ - –ö–û–§–ï
timeline.push(...createRATTrial({words: ['–ü–ò–¢–¨', '–í–ê–†–ò–¢–¨', '–ú–û–õ–û–¢–¨'], answer: '–ö–û–§–ï'}, 0, true));

timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
        <div class="rat-container">
            <p style="font-size: 24px;">‚úì –ü—Ä–æ–±–Ω–∞—è –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</p>
            <br>
            <p>–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –∑–∞–¥–∞—á–∞–º</p>
            <p>–í—Å–µ–≥–æ –±—É–¥–µ—Ç <strong>20 –∑–∞–¥–∞—á</strong></p>
            <br><br>
            <p><em>–ù–∞–∂–º–∏—Ç–µ –ü–†–û–ë–ï–õ –¥–ª—è –Ω–∞—á–∞–ª–∞</em></p>
        </div>
    `,
    choices: [' ']
});

// –û—Å–Ω–æ–≤–Ω—ã–µ 20 –∑–∞–¥–∞—á
for (let i = 0; i < RAT_TASKS.length; i++) {
    timeline.push(...createRATTrial(RAT_TASKS[i], i + 1, false));
}

jsPsych.run(timeline);

</script>
</html>
